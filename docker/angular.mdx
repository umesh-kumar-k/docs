# Docker Containerization for Angular Apps - **DETAILED** Page-wise Analysis

**Official Docker Angular guide**: Complete lifecycle from `docker init` → multi-stage prod (Node→NGINX), dev hot-reload, Jasmine tests, GitHub Actions CI/CD, K8s deploy. **76MB → 25MB** optimized SPA images.[1][2]

## **DETAILED Page-wise Breakdown**

### **1. Containerize (docs.docker.com/guides/angular/containerize/)**

**Prerequisites & Setup:**
```
git clone https://github.com/kristiyan-velkov/docker-angular-sample
cd docker-angular-sample
docker init  # Auto-generates: Dockerfile, .dockerignore, compose.yaml, README.Docker.md
```

**`docker init` Prompts & Answers:**
| Question | Answer | Why |
|----------|--------|-----|
| Platform | **Node** | Angular runtime |
| Node Version | **23.11.0-alpine** | Lightweight |
| Package Manager | **npm** | Standard |
| Build Before Start | **yes** | `npm run build` |
| Build Output | **dist** | Angular CLI default |
| Start Command | **npm run start** | Prod server |
| Port | **8080** | NGINX default |

**Multi-stage Dockerfile (Detailed):**
```dockerfile
# =========================================
# BUILDER STAGE (800MB → discarded)
# =========================================
ARG NODE_VERSION=24.7.0-alpine
FROM node:${NODE_VERSION} AS builder
WORKDIR /app

# 1. Cache deps FIRST (stable layer)
COPY package.json package-lock.json ./
RUN --mount=type=cache,target=/root/.npm npm ci  # Clean install

# 2. Copy source (volatile layer)
COPY . .
RUN npm run build  # → dist/*/browser/

# =========================================
# RUNNER STAGE (25MB final image)
# =========================================
FROM nginxinc/nginx-unprivileged:alpine3.22 AS runner
USER nginx  # Security: non-root
COPY nginx.conf /etc/nginx/nginx.conf
COPY --chown=nginx:nginx --from=builder /app/dist/*/browser /usr/share/nginx/html
EXPOSE 8080
ENTRYPOINT ["nginx", "-c", "/etc/nginx/nginx.conf"]
CMD ["-g", "daemon off;"]
```

**NGINX Config (nginx.conf) - Critical for SPA:**
```nginx
# Angular SPA Routing (MUST HAVE)
location / {
  try_files $uri $uri/ /index.html;  # Fallback for client routes
}

# 1y Immutable Cache (perf)
location ~* \.(css|js|gif|png|woff2?|svg)$ {
  expires 1y;
  add_header Cache-Control "public, immutable";
}

# Gzip Compression
gzip on;
gzip_types text/css application/json application/javascript;
```

**`.dockerignore` Categories:**
```
# Build artifacts: node_modules, dist, .angular
# Tests: coverage, cypress/videos
# Secrets: *.env*, *.log
# IDE: .vscode, .idea
# Git: .git, .gitignore
# Docker: Dockerfile.*, docker-compose.*
```

**Build & Run Commands:**
```bash
docker build -t docker-angular-sample .
docker compose up --build  # http://localhost:8080
docker compose up -d --build  # Background
docker ps  # Verify: 0.0.0.0:8080→8080/tcp
docker compose down  # Cleanup
```

### **2. Development (docs.docker.com/guides/angular/develop/)**

**`Dockerfile.dev` (Hot Reload Server):**
```dockerfile
ARG NODE_VERSION=24.7.0-alpine
FROM node:${NODE_VERSION} AS dev
ENV NODE_ENV=development
WORKDIR /app
COPY package*.json ./
RUN --mount=type=cache npm install  # Dev deps
COPY . .
EXPOSE 4200
CMD ["npm", "start", "--", "--host=0.0.0.0"]  # Bind all interfaces
```

**`compose.yaml` Dual Mode:**
```yaml
services:
  # PROD: NGINX static serve (8080)
  angular-prod:
    build: { dockerfile: Dockerfile }
    ports: ["8080:8080"]
  
  # DEV: Angular CLI dev server (4200)
  angular-dev:
    build: { dockerfile: Dockerfile.dev }
    ports: ["4200:4200"]
    develop:
      watch:  # COMPOSE WATCH MAGIC
        - action: sync
          path: .  # Host src
          target: /app  # Container
```

**Compose Watch Workflow:**
```bash
docker compose watch angular-dev  # Starts watcher
# Edit src/app/app.component.html → INSTANT browser update @ localhost:4200
# No rebuild, no restart - pure file sync
```

**Verification Test:**
```
1. Change <h1>Docker Angular Sample</h1> → <h1>Hello Docker Watch!</h1>
2. Save file
3. Browser: localhost:4200 → IMMEDIATE update
4. Ctrl+C → docker compose down
```

### **3. Run Tests (docs.docker.com/guides/angular/run-tests/)**

**Test Service (`compose.yaml`):**
```yaml
angular-test:
  build: { dockerfile: Dockerfile.dev }  # Reuse dev deps
  command: npm run test  # Jasmine/Karma
```

**Run Tests:**
```bash
docker compose run --rm angular-test
# Output:
# ✓ AppComponent should render title
# 3 specs, 0 failures (100%)
```

**Benefits:**
- **Identical env** as dev/prod
- **No local Node** required
- `--rm`: Auto-cleanup container

### **4. GitHub Actions CI/CD (docs.docker.com/guides/angular/configure-github-actions/)**

**Repository Secrets (Settings → Secrets):**
| Name | Value |
|------|-------|
| `DOCKER_USERNAME` | dockerhub username |
| `DOCKERHUB_TOKEN` | Docker Hub token |
| `DOCKERHUB_PROJECT_NAME` | `username/angular-sample` |

**`.github/workflows/main.yml` (Complete Workflow):**
```yaml
name: Angular CI/CD
on: [push, pull_request]
jobs:
  build-test-push:
    runs-on: ubuntu-latest
    steps:
    # 1. Checkout
    - uses: actions/checkout@v4
    
    # 2. Docker Buildx (multi-arch)
    - uses: docker/setup-buildx-action@v3
    
    # 3. Cache npm + Docker layers
    - uses: actions/cache@v4
      with:
        key: npm-${{ hashFiles('**/package-lock.json') }}
        path: |
          ~/.npm
          /tmp/.buildx-cache
    
    # 4. Build + Test (Dockerfile.dev)
    - uses: docker/build-push-action@v6
      with:
        context: .
        file: Dockerfile.dev
        load: true
        cache-from: type=gha
        cache-to: type=gha
    - run: docker run angular-sample npm run test -- --ci
    
    # 5. Login + Push Prod
    - uses: docker/login-action@v3
      with: { username: ${{ secrets.DOCKER_USERNAME }}, password: ${{ secrets.DOCKERHUB_TOKEN }} }
    - uses: docker/build-push-action@v6
      with:
        context: .
        push: true
        tags: |
          ${{ secrets.DOCKERHUB_PROJECT_NAME }}:latest
          ${{ secrets.DOCKERHUB_PROJECT_NAME }}:${{ github.sha }}
        platforms: linux/amd64,linux/arm64
        cache-from: type=gha
```

**Timeline:** Cold: 8min → Cached: 1.5min

### **5. Kubernetes Deploy (docs.docker.com/guides/angular/deploy/)**

**`angular-sample-kubernetes.yaml`:**
```yaml
# Deployment (1 replica)
apiVersion: apps/v1
kind: Deployment
metadata: { name: angular-deployment }
spec:
  replicas: 1
  selector: { matchLabels: { app: angular-app } }
  template:
    metadata: { labels: { app: angular-app } }
    spec:
      containers:
      - name: angular-container
        image: username/angular-sample:latest
        resources:
          limits:  # Prod constraints
            cpu: "500m"
            memory: "256Mi"
        ports: [{ containerPort: 8080 }]

---
# Service (NodePort for local)
apiVersion: v1
kind: Service
metadata: { name: angular-service }
spec:
  type: NodePort
  selector: { app: angular-app }
  ports:
  - port: 8080
    targetPort: 8080
    nodePort: 30001  # localhost:30001
```

**Deploy Commands:**
```bash
kubectl apply -f angular-sample-kubernetes.yaml
kubectl get deployments,pods,services
# Access: http://localhost:30001
kubectl delete -f angular-sample-kubernetes.yaml
```

## **Best Practices & Trade-offs (Detailed)**

| Practice | ✅ Benefits | ❌ Trade-offs | When to Use |
|----------|-------------|---------------|-------------|
| **Multi-stage** | 76MB→25MB, no Node in prod | Complex syntax | **Always prod** |
| **`nginx-unprivileged`** | Non-root security | Port 8080 (not 80) | **Security-first** |
| **`--mount=type=cache`** | 5x faster npm | BuildKit required | **CI/CD + local** |
| **Layer Order** | Cache hits on deps | Plan changes ahead | **All builds** |
| **`.dockerignore`** | 50% faster context | Maintain list | **Always** |
| **Compose Watch** | Zero-rebuild dev | Volume I/O | **Local dev** |

## **Interview Cheat Sheet (Q&A)**

**Q: Why `nginx-unprivileged` over `nginx:alpine`?**  
A: **Security** - runs as `USER nginx` (non-root), smaller attack surface. Port 8080 default[1]

**Q: Angular SPA routing in NGINX?**  
A: `try_files $uri $uri/ /index.html` - falls back to `index.html` for client routes

**Q: `docker compose watch` vs `docker compose up`?**  
A: **Watch**: file sync + auto-restart (dev); **Up**: static build/serve (prod)

**Q: GitHub Actions cache strategy?**  
A: `npm-${{ hashFiles('package-lock.json') }}` + `buildx-${{ github.sha }}` → 8min→1.5min

**Q: K8s `NodePort` vs `LoadBalancer`?**  
A: **NodePort**: Local/minikube (`30001`); **LoadBalancer**: Cloud (external IP)

**Q: Multi-stage benefit quantification?**  
A: **Node: 800MB** (build tools) → **NGINX: 25MB** (static assets only)

## **Important Terms & Keywords**

**Files & Configs:**
- `docker init` - Auto-scaffolds Angular Docker files
- `Dockerfile` (prod) vs `Dockerfile.dev` (4200)
- `nginx.conf` - SPA routing + 1y cache + gzip
- `.dockerignore` - Exclude `node_modules`/`.git`/dist
- `compose.yaml` - `angular-prod/dev/test` services

**Commands:**
- `docker compose watch` - Hot reload magic
- `docker compose run --rm angular-test` - One-off tests
- `docker/build-push-action@v6` - Multi-arch CI

**Advanced:**
- `--mount=type=cache` - BuildKit npm cache
- `nginxinc/nginx-unprivileged` - Secure runner
- `try_files $uri $uri/ /index.html` - SPA fallback
- `platforms: linux/amd64,linux/arm64` - Universal images[2][3][4][5][1]

[1](https://docs.docker.com/guides/angular/containerize/)
[2](https://docs.docker.com/guides/angular/develop/)
[3](https://angular.dev/api/core/rxjs-interop/toObservable)
[4](https://v18.angular.jp/guide/signals/rxjs-interop)
[5](https://dev.to/cristiansifuentes/angular-rxjs-in-2025-the-experts-playbook-signals-rxjs-8-and-interop-28ed)