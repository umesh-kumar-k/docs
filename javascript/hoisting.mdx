# JavaScript Hoisting - **DETAILED** Execution Phases

**JS Engine**: **Creation Phase** (memory allocation) **before** execution. **Functions**: full reference; **var**: `undefined`; **let/const**: **uninitialized** (Temporal Dead Zone). **NOT** physical movement to top.[1]

## **DETAILED Section-wise Breakdown**

### **1. JS Engine Execution Phases**

**Two-Phase Process:**
```
1. CREATION PHASE (Memory Setup - NO execution)
   - Scan entire scope
   - Allocate memory for functions/variables
   - Initialize with defaults
   
2. EXECUTION PHASE (Line-by-line)
   - Run code top-to-bottom
   - Overwrite creation phase values
```

**Memory Allocation Differences:**
| Declaration | Memory Storage | Pre-Declaration Access |
|-------------|----------------|----------------------|
| **`function foo() {}`** | **Full function reference** | ✅ Callable |
| **`var x = 42`** | `undefined` | ✅ `undefined` |
| **`let/const x = 42`** | **Uninitialized** | ❌ **ReferenceError** (TDZ) |

### **2. Function Hoisting (Full Reference)**

**Creation Phase Stores Complete Function:**
```javascript
// Execution sees this memory state:
foo = function() { return 'Hello'; }  // Full body stored
bar = undefined;  // var
baz = uninitialized;  // let

console.log(foo());  // "Hello" ✅
foo();  // Works before declaration line
```

**Complete Example:**
```javascript
console.log(foo());  // "Function works!"

function foo() {
  return 'Function works!';
}

var bar = 'var works';
let baz = 'let fails before';
console.log(bar);  // undefined
console.log(baz);  // ReferenceError: Cannot access 'baz' before initialization
```

### **3. Variable Hoisting Differences**

**var (Legacy - Problematic):**
```javascript
console.log(x);  // undefined ✅ (default value)
var x = 42;
console.log(x);  // 42 (overwritten during execution)
```
**Memory Timeline:**
```
Creation: x = undefined
Execution line 3: x = 42 (assignment)
```

**let/const (Modern - Safer):**
```javascript
console.log(x);  // ReferenceError: Cannot access before initialization ❌
let x = 42;
```
**Temporal Dead Zone (TDZ):**
```
Creation: x = uninitialized (hole in memory)
Line 1: ReferenceError (TDZ active)
Line 3: x = 42 (TDZ ends, value assigned)
```

### **4. Hoisting Visual Timeline**

**Complete Script Execution:**
```javascript
// LINE 1 (Execution Phase)
console.log(a);  // undefined (var)
console.log(b);  // ReferenceError (let TDZ)
console.log(c());  // "Function hoisted!"

// LINE 8-10 (Declarations - Overwrite memory)
var a = 1;
let b = 2;
function c() { return "Function hoisted!"; }
```

**Memory State Evolution:**
```
CREATION PHASE:
a: undefined
b: <uninitialized>
c: [full function body]

EXECUTION LINE 1:
a: undefined → console.log(undefined)

EXECUTION LINE 3:
c: [function] → "Function hoisted!"

EXECUTION LINE 8:
a: undefined → 1

EXECUTION LINE 9:
b: <uninitialized> → 2 (TDZ ends)
```

## **Key Classes/Interfaces (Engine Internals)**

| Engine Phase | What Happens | Data Structure |
|--------------|-------------|---------------|
| **Creation** | Memory allocation | **Lexical Environment** |
| **Functions** | Full code reference | **Function Object** |
| **`var`** | `undefined` init | **Variable Environment** |
| **`let/const`** | Uninitialized | **Lexical Environment** (TDZ flag) |

## **Design Patterns & Common Pitfalls**

**✅ Safe Patterns:**
```javascript
// 1. Function declarations (always safe)
function apiCall() { /* full body available */ }

// 2. Declare before use (modern)
const config = { apiUrl: '/api' };
let state;

// 3. Block scope safety
if (true) {
  let localVar = 'safe';  // No TDZ issues in block
}
```

**❌ Dangerous Patterns:**
```javascript
// var undefined trap
if (user.role) {  // undefined → falsy → skips block
  doAdmin(user);
}
var user = getUser();  // Intended: skips admin

// let TDZ (safer error)
console.log(user);  // ReferenceError (catches bug early)
let user = getUser();
```

## **Best Practices & Trade-offs**

| Practice | ✅ Why | ❌ Risk |
|----------|--------|---------|
| **`let/const` first** | **TDZ protection** | Refactor cost |
| **Functions at top** | Predictable hoisting | File organization |
| **Avoid `var`** | **Block scope**, no TDZ issues | Legacy code |
| **Declare before use** | No surprises | Verbose |

**Modern Linting:**
```json
// .eslintrc
{
  "rules": {
    "no-var": "error",
    "no-use-before-define": ["error", { "functions": false }]
  }
}
```

## **Advanced Topics**

**1. Classes (let-like TDZ):**
```javascript
new MyClass();  // ReferenceError (TDZ)
class MyClass {}  // Classes NOT hoisted like functions
```

**2. Arrow Functions (var/let behavior):**
```javascript
console.log(fn);  // undefined/ReferenceError
var fn = () => {};  // var behavior
let fn = () => {};  // let TDZ
```

**3. Global Undeclared Variables:**
```javascript
x = 10;  // Creates global var (BAD)
console.log(x);  // 10 (window.x in browser)
```

## **Interview Cheat Sheet (Q&A)**

**Q: Predict output/behavior:**
```javascript
console.log(a);  // ?
var a = 1;
console.log(b);  // ?
let b = 2;
foo();  // ?
function foo() { console.log('hoisted'); }
```
**A: `undefined →  ReferenceError → "hoisted"`**[1]

**Q: Why `var` returns `undefined` but `let` throws?**
**A: `var`: initialized `undefined`; `let`: **uninitialized** (TDZ protection)**

**Q: Function vs Arrow function hoisting?**
**A: **Function**: full body hoisted; **Arrow**: var/let behavior (no function hoisting)**

**Q: Classes hoisting behavior?**
**A: **let-like TDZ** - `new MyClass()` before declaration → ReferenceError

**Q: `"use strict"` impact?**
**A: Undeclared globals → **ReferenceError** (safer)

**Q: Temporal Dead Zone purpose?**
**A: **Catch bugs early** - prevents accidental `undefined` usage

## **Important Terms & Keywords (Complete)**

**Core Concepts:**
- **Hoisting** - Creation phase memory allocation
- **Creation Phase** - Pre-execution memory setup
- **Execution Phase** - Line-by-line code running
- **Temporal Dead Zone (TDZ)** - let/const pre-declaration zone

**Declaration Types:**
- **Function Declaration** - Full body reference (callable anywhere)
- **`var`** - `undefined` initialized (problematic)
- **`let/const`** - Uninitialized (safer, TDZ)

**Engine Internals:**
- **Lexical Environment** - Variable storage
- **Variable Environment** - var-specific storage
- **ReferenceError** - TDZ access attempt

**Modern Rules:**
- **Block Scope** - let/const respect blocks
- **Strict Mode** - No implicit globals
- **Linting** - Enforce declaration order[1]

[1](https://dev.to/lydiahallie/javascript-visualized-hoisting-478h)